#!/usr/bin/env bash
set -e

PORT="${PORT:-3001}"

echo 'Preparing test database'
RAILS_ENV=test bin/rails db:test:prepare
RAILS_ENV=test bin/rails server -p $PORT &
RAILS_PID=$!

echo 'Starting Playwright'
npx playwright test --config=e2e/playwright.config.js "$@"

kill "$RAILS_PID"
wait "$RAILS_PID" 2>/dev/null || true
